<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"kevincabbage.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="手眼标定中经典问题求解分析">
<meta property="og:type" content="article">
<meta property="og:title" content="AX&#x3D;XB求解">
<meta property="og:url" content="http://kevincabbage.github.io/2023/07/04/AX-XB%E6%B1%82%E8%A7%A3/index.html">
<meta property="og:site_name" content="大白菜的博客">
<meta property="og:description" content="手眼标定中经典问题求解分析">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-07-04T09:02:10.000Z">
<meta property="article:modified_time" content="2023-07-04T09:57:33.551Z">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://kevincabbage.github.io/2023/07/04/AX-XB%E6%B1%82%E8%A7%A3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://kevincabbage.github.io/2023/07/04/AX-XB%E6%B1%82%E8%A7%A3/","path":"2023/07/04/AX-XB求解/","title":"AX=XB求解"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AX=XB求解 | 大白菜的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">大白菜的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8F%98%E6%8D%A2"><span class="nav-number">1.</span> <span class="nav-text">基本变换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#hat%E8%BF%90%E7%AE%97%E7%AC%A6-land"><span class="nav-number">1.1.</span> <span class="nav-text">hat运算符 \(\land\)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vee%E8%BF%90%E7%AE%97%E7%AC%A6-lor"><span class="nav-number">1.2.</span> <span class="nav-text">vee运算符 \(\lor\)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E6%95%B0%E6%98%A0%E5%B0%84"><span class="nav-number">1.3.</span> <span class="nav-text">指数映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%95%B0%E6%98%A0%E5%B0%84"><span class="nav-number">1.4.</span> <span class="nav-text">对数映射</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#navy%E6%89%8B%E7%9C%BC%E6%A0%87%E5%AE%9A%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">Navy手眼标定算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A6%E6%9C%89%E5%88%9D%E5%80%BC%E7%9A%84%E8%BF%91%E4%BC%BC%E8%A7%A3"><span class="nav-number">2.1.</span> <span class="nav-text">带有初值的近似解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90"><span class="nav-number">2.2.</span> <span class="nav-text">误差分析</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description">人生哪能多如意，万事只求半称心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://kevincabbage.github.io/2023/07/04/AX-XB%E6%B1%82%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大白菜的博客">
      <meta itemprop="description" content="人生哪能多如意，万事只求半称心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="AX=XB求解 | 大白菜的博客">
      <meta itemprop="description" content="手眼标定中经典问题求解分析">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AX=XB求解
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-07-04 17:02:10 / 修改时间：17:57:33" itemprop="dateCreated datePublished" datetime="2023-07-04T17:02:10+08:00">2023-07-04</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">手眼标定中经典问题求解分析</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>slam 中的手眼标定最后可以归结为求解如下问题</p>
<p>已知 <span class="math inline">\(\boldsymbol A_i, \boldsymbol B_i \in
SO(3)\)</span>，需要求解 <span class="math inline">\(\boldsymbol X \in
SO(3)\)</span>，满足 <span class="math display">\[
\min \sum_{i = 1}^n d(\boldsymbol A_i \boldsymbol X - \boldsymbol X
\boldsymbol B_i)
\]</span></p>
<p>其中 <span class="math inline">\(SO(3)\)</span>
即为旋转矩阵，网上有多种求解方法，这里只描述其中几种，首先介绍下一些基本的变换</p>
<h2 id="基本变换">基本变换</h2>
<h3 id="hat运算符-land">hat运算符 <span
class="math inline">\(\land\)</span></h3>
<p>把三维实向量 <span class="math inline">\(\boldsymbol\omega\)</span>
映射到 <span class="math inline">\(3 \times 3\)</span> 反对称阵 <span
class="math inline">\(\boldsymbol W\)</span> <span
class="math display">\[
\boldsymbol \omega^{\land}
=\begin{bmatrix}
\omega_1\\
\omega_2\\
\omega_3
\end{bmatrix}^{\land}
=\begin{bmatrix}
0 &amp; -\omega_3 &amp; \omega_2 \\
\omega_3 &amp; 0 &amp; -\omega_1 \\
-\omega_2 &amp; \omega_1 &amp; 0
\end{bmatrix}
=\boldsymbol W
\]</span></p>
<p>性质1：<span class="math inline">\(\boldsymbol a^\land \boldsymbol b
= - \boldsymbol b^\land \boldsymbol a\)</span>，直接推导即可证明</p>
<p>性质2：<span class="math inline">\(\boldsymbol \omega^\land
\boldsymbol \omega^\land \boldsymbol \omega^\land = - \| \boldsymbol
\omega \|^2 \boldsymbol \omega^\land\)</span>，直接推导即可证明</p>
<p>性质3：<span class="math inline">\(\boldsymbol \omega \boldsymbol
\omega^T - \boldsymbol \omega^\land \boldsymbol \omega^\land = \|
\boldsymbol \omega \|^2 \boldsymbol I\)</span>，直接推导即可证明</p>
<p>性质4：<span class="math inline">\((\boldsymbol R \boldsymbol
v)^\land = \boldsymbol R \boldsymbol v^\land \boldsymbol
R^T\)</span>，证明如下 <span class="math display">\[
\begin{aligned}
&amp;\forall \boldsymbol u \in \mathbb R^3, (\boldsymbol R \boldsymbol
v)  \times (\boldsymbol R \boldsymbol u) = \boldsymbol R(\boldsymbol v
\times \boldsymbol u) \\
\Rightarrow &amp;\forall \boldsymbol u \in \mathbb R^3, (\boldsymbol R
\boldsymbol v)^\land (\boldsymbol R \boldsymbol u) = \boldsymbol
R(\boldsymbol v^\land \boldsymbol u) \\
\Rightarrow &amp;\forall \boldsymbol u \in \mathbb R^3, (\boldsymbol R
\boldsymbol v)^\land \boldsymbol R \boldsymbol u = \boldsymbol R
\boldsymbol v^\land \boldsymbol u \\
\Rightarrow &amp;(\boldsymbol R \boldsymbol v)^\land \boldsymbol R =
\boldsymbol R \boldsymbol v^\land \\
\Rightarrow &amp;(\boldsymbol R \boldsymbol v)^\land = \boldsymbol R
\boldsymbol v^\land \boldsymbol R^T
\end{aligned}
\]</span></p>
<h3 id="vee运算符-lor">vee运算符 <span
class="math inline">\(\lor\)</span></h3>
<p>把 <span class="math inline">\(3 \times 3\)</span> 反对称阵 <span
class="math inline">\(\boldsymbol W\)</span> 映射到三维实向量 <span
class="math inline">\(\boldsymbol\omega\)</span> <span
class="math display">\[
\boldsymbol W^{\lor}
=\begin{bmatrix}
0 &amp; -\omega_3 &amp; \omega_2 \\
\omega_3 &amp; 0 &amp; -\omega_1 \\
-\omega_2 &amp; \omega_1 &amp; 0
\end{bmatrix}^{\lor}
=\begin{bmatrix}
\omega_1\\
\omega_2\\
\omega_3
\end{bmatrix}
=\boldsymbol\omega
\]</span></p>
<h3 id="指数映射">指数映射</h3>
<p>把 <span class="math inline">\(3 \times 3\)</span> 反对称阵 <span
class="math inline">\(\boldsymbol W\)</span> 映射到旋转矩阵 <span
class="math inline">\(\boldsymbol R\)</span> <span
class="math display">\[
e^{\boldsymbol W}
= \boldsymbol I + \frac{\sin \| \boldsymbol W^\lor \|}{\| \boldsymbol
W^\lor \|} \boldsymbol W + \frac{1 - \cos \| \boldsymbol W^\lor \|}{\|
\boldsymbol W^\lor \|^2} \boldsymbol W^2
= \boldsymbol R
\]</span></p>
<p>性质1：假设 <span class="math inline">\(\theta = || \boldsymbol
W^\lor||=\sqrt{\boldsymbol \omega_1^2 + \boldsymbol \omega_2^2 +
\boldsymbol \omega_3^2}\)</span> 为向量模长，即 <span
class="math inline">\(\boldsymbol \omega = \theta \hat{\boldsymbol
\omega}\)</span> <span class="math display">\[
\begin{aligned}
e^{\boldsymbol W}
&amp;= \sum_{n = 0}^\infty \frac{1}{n!} \boldsymbol W^n
= \sum_{n = 0}^\infty \frac{1}{n!} (\boldsymbol \omega^\land)^n
= \sum_{n = 0}^\infty \frac{1}{n!} (\theta \hat{\boldsymbol
\omega}^\land)^n \\
&amp;= \boldsymbol I + \theta \hat{\boldsymbol \omega}^\land +
\frac{1}{2!}\theta^2 \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land +
\frac{1}{3!}\theta^3 \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land \hat{\boldsymbol \omega}^\land +
\frac{1}{4!}\theta^4 \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land + \cdots \\
&amp;= \boldsymbol I + \theta \hat{\boldsymbol \omega}^\land +
\frac{1}{2!}\theta^2 \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land -
\frac{1}{3!}\theta^3 \hat{\boldsymbol \omega}^\land -
\frac{1}{4!}\theta^4 \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land + \cdots \\
&amp;= \boldsymbol I + \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land +
\bigg(\theta - \frac{1}{3!} \theta^3 + \cdots \bigg) \hat{\boldsymbol
\omega}^\land -
\bigg(1 - \frac{1}{2!} \theta^2 + \frac{1}{4!} \theta^4 - \cdots \bigg)
\hat{\boldsymbol \omega}^\land \hat{\boldsymbol \omega}^\land \\
&amp;= \boldsymbol I + \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land +\sin \theta \hat{\boldsymbol \omega}^\land - \cos \theta
\hat{\boldsymbol \omega}^\land \hat{\boldsymbol \omega}^\land\\
&amp;= \boldsymbol I +
\sin \theta \hat{\boldsymbol \omega}^\land +
(1 - \cos \theta) \hat{\boldsymbol \omega}^\land \hat{\boldsymbol
\omega}^\land
\end{aligned}
\]</span></p>
<p>这也正是罗德里格斯公式，可以从旋转几何出发进行推导</p>
<p>性质2：<span class="math inline">\(\forall \boldsymbol X \in SO(3),
e^{\boldsymbol X \boldsymbol W \boldsymbol X^T} = \boldsymbol X
e^\boldsymbol W \boldsymbol X^T\)</span>，证明如下 <span
class="math display">\[
\begin{aligned}
e^{\boldsymbol X \boldsymbol W \boldsymbol X^T} &amp;= \sum_{n=0}^\infty
\frac{1}{n!} (\boldsymbol X \boldsymbol W \boldsymbol X^T)^n \\
&amp;= \sum_{n=0}^\infty \frac{1}{n!} \underbrace{\boldsymbol X
\boldsymbol W \boldsymbol X^T \boldsymbol X \boldsymbol W\boldsymbol X^T
\cdots \boldsymbol X \boldsymbol W\boldsymbol X^T}_n \\
&amp;= \sum_{n=0}^\infty \frac{1}{n!} \boldsymbol X \boldsymbol W^n
\boldsymbol X^T \\
&amp;= \boldsymbol X \bigg(\sum_{n=0}^\infty \frac{1}{n!} \boldsymbol
W^n \bigg) \boldsymbol X^T \\
&amp;= \boldsymbol X e^{\boldsymbol W} \boldsymbol X^T
\end{aligned}
\]</span></p>
<h3 id="对数映射">对数映射</h3>
<p>把旋转矩阵 <span class="math inline">\(\boldsymbol R\)</span> 映射到
<span class="math inline">\(3 \times 3\)</span> 反对称阵 <span
class="math inline">\(\boldsymbol W\)</span> <span
class="math display">\[
\log \boldsymbol R
= \frac{\varphi (\boldsymbol R - \boldsymbol R^T)}{2 \sin \varphi}
=\boldsymbol W
\]</span></p>
<p>其中 <span class="math inline">\(\varphi = \arccos \bigg(
\frac{tr(\boldsymbol R) - 1}{2} \bigg)\)</span></p>
<h2 id="navy手眼标定算法">Navy手眼标定算法</h2>
<p>论文 "Robot sensor calibration: solving AX=XB on the Euclidean
group"</p>
<p>考虑到 <span class="math inline">\(\boldsymbol A_i, \boldsymbol
B_i\)</span> 均为旋转矩阵，因此存在三维实向量 <span
class="math inline">\(\boldsymbol \omega_{A_i} = (\log \boldsymbol
A_i)^\lor, \boldsymbol \omega_{B_i} = (\log \boldsymbol
B_i)^\lor\)</span> 使得 <span class="math display">\[
\boldsymbol A_i = e^{\boldsymbol \omega_{A_i}^\land},
\boldsymbol B_i = e^{\boldsymbol \omega_{B_i}^\land}
\]</span></p>
<p>利用前面的性质可以得到 <span class="math display">\[
\begin{aligned}
\boldsymbol A_i \boldsymbol X &amp;= \boldsymbol X \boldsymbol B_i \\
\boldsymbol A_i &amp;= \boldsymbol X \boldsymbol B_i \boldsymbol X^T \\
e^{\boldsymbol \omega_{A_i}^\land} &amp;= \boldsymbol X e^{\boldsymbol
\omega_{B_i}^\land} \boldsymbol X^T \\
e^{\boldsymbol \omega_{A_i}^\land} &amp;= e^{\boldsymbol X \boldsymbol
\omega_{B_i}^\land \boldsymbol X^T} \\
e^{\boldsymbol \omega_{A_i}^\land} &amp;= e^{(\boldsymbol X \boldsymbol
\omega_{B_i})^\land}
\end{aligned}
\]</span></p>
<p>因此求解 <span class="math inline">\(\boldsymbol A_i \boldsymbol X =
\boldsymbol X \boldsymbol B_i\)</span> 等价于求解 <span
class="math inline">\(\boldsymbol \omega_{A_i} = \boldsymbol X
\boldsymbol \omega_{B_i}\)</span> 因此原问题将会变为如下问题 <span
class="math display">\[
\min \sum_{i = 1}^n w_i d(\boldsymbol X \boldsymbol \omega_{\boldsymbol
B_i} - \boldsymbol \omega_{A_i})
\]</span></p>
<p>如果定义距离 <span class="math inline">\(d\)</span>
为欧式距离，则该问题将会变成经典问题 <span class="math display">\[
\min \sum_{i = 1}^n w_i \| \boldsymbol X \boldsymbol \omega_{\boldsymbol
B_i} - \boldsymbol \omega_{A_i} \|^2
\]</span></p>
<p>具体推导在另一篇文章<a href="/2023/07/04/%E7%82%B9%E4%BA%91%E7%B2%BE%E9%85%8D%E5%87%86/" title="点云精配准">点云精配准</a>求解旋转矩阵 <span
class="math inline">\(\boldsymbol R\)</span>
中有详细描述，这里直接给出求解步骤：</p>
<ol type="1">
<li><p>找到一系列旋转矩阵 <span class="math inline">\(\boldsymbol A_i,
\boldsymbol B_i\)</span>，计算对应的三维向量 <span
class="math inline">\(\boldsymbol \omega_{A_i} = (\log \boldsymbol
A_i)^\lor, \boldsymbol \omega_{B_i} = (\log \boldsymbol
B_i)^\lor\)</span></p></li>
<li><p>根据权重，计算等效中心 <span
class="math inline">\(\overline{\boldsymbol{\omega}}_{\boldsymbol{A}} =
\frac{\sum_{i = 1}^n w_i \boldsymbol{\omega}_{\boldsymbol{A}_i}}{\sum_{i
= 1}^n w_i}, \overline{\boldsymbol{\omega}}_{\boldsymbol{B}} =
\frac{\sum_{i = 1}^n w_i \boldsymbol{\omega}_{\boldsymbol{B}_i}}{\sum_{i
= 1}^n w_i}\)</span></p></li>
<li><p>对协方差矩阵 <span class="math inline">\(\boldsymbol
\Sigma\)</span> 进行SVD分解 <span class="math inline">\(\boldsymbol
\Sigma = \boldsymbol U \boldsymbol \Lambda \boldsymbol
V^T\)</span>，其中协方差矩阵 <span class="math inline">\(\boldsymbol
\Sigma\)</span> 为 <span class="math display">\[
\begin{aligned}
\boldsymbol{\Sigma} =&amp;
\begin{bmatrix}
\hat{\boldsymbol{\omega}}_{\boldsymbol{B}_1} &amp; \cdots &amp;
\hat{\boldsymbol{\omega}}_{\boldsymbol{B}_n}
\end{bmatrix}
\begin{bmatrix}
w_1 &amp; 0 &amp; \cdots &amp; 0 \\
0 &amp; w_2 &amp; \cdots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; w_n
\end{bmatrix}
\begin{bmatrix}
\hat{\boldsymbol{\omega}}_{\boldsymbol{A}_1}^T \\
\vdots \\
\hat{\boldsymbol{\omega}}_{\boldsymbol{A}_n}^T
\end{bmatrix}\\
=&amp;\sum_{i = 1}^n \omega_i
\hat{\boldsymbol{\omega}}_{\boldsymbol{B}_i}\hat{\boldsymbol{\omega}}_{\boldsymbol{A}_i}^T
=\sum_{i = 1}^n \omega_i
\boldsymbol{\omega}_{\boldsymbol{B}_i}\boldsymbol{\omega}_{\boldsymbol{A}_i}^T
-
\overline{\boldsymbol{\omega}}_{\boldsymbol{B}}\overline{\boldsymbol{\omega}}_{\boldsymbol{A}}^T\sum_{i
= 1}^n \omega_i
\end{aligned}
\]</span></p></li>
<li><p>求解得到旋转矩阵 <span class="math inline">\(\boldsymbol X^* =
\boldsymbol V \begin{bmatrix} 1 &amp; 0 &amp; \cdots &amp; 0 \\ 0 &amp;
1 &amp; \cdots &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots
\\ 0 &amp; 0 &amp; \cdots &amp; |\boldsymbol V \boldsymbol U^T|
\end{bmatrix}\boldsymbol U^T\)</span></p></li>
</ol>
<h3 id="带有初值的近似解">带有初值的近似解</h3>
<p>如果有一个不错的初值 <span class="math inline">\(\boldsymbol X_0 \in
SO(3)\)</span>，问题变成需要求解得到一个 <span
class="math inline">\(\boldsymbol Y\)</span> 使得 <span
class="math display">\[
\boldsymbol Y \boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i} =
\boldsymbol \omega_{A_i}, \quad i = 1,\cdots, n
\]</span></p>
<p>注意到 <span class="math inline">\(\boldsymbol Y = \boldsymbol X^*
\boldsymbol X_0^T\)</span>，因此 <span class="math inline">\(\boldsymbol
Y \in SO(3)\)</span> 可以用欧拉角表示，同时注意到 <span
class="math inline">\(\boldsymbol X_0\)</span> 是一个不错的初值，因此有
<span class="math inline">\(yall, pitch, roll \to 0\)</span>，进而 <span
class="math inline">\(\boldsymbol Y\)</span> 可以近似表示成 <span
class="math display">\[
\begin{aligned}
\boldsymbol Y
=&amp; \boldsymbol R_z(yall) \boldsymbol R_y(pitch) \boldsymbol
R_x(roll) \\
=&amp;
\begin{bmatrix}
\cos y &amp; -\sin y &amp; 0\\
\sin y &amp; \cos y &amp; 0\\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
\cos p &amp; 0 &amp; \sin p\\
0 &amp; 1 &amp; 0\\
-\sin p &amp; 0 &amp; \cos p
\end{bmatrix}
\begin{bmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; \cos r &amp; -\sin r\\
0 &amp; \sin r &amp; \cos r\\
\end{bmatrix} \\
\approx&amp;
\begin{bmatrix}
1 &amp; -y &amp; 0\\
y &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
1 &amp; 0 &amp; p\\
0 &amp; 1 &amp; 0\\
-p &amp; 0 &amp;1
\end{bmatrix}
\begin{bmatrix}
1 &amp; 0 &amp; 0\\
0 &amp; 1 &amp; -r\\
0 &amp; r &amp; 1\\
\end{bmatrix} \\
\approx&amp; \begin{bmatrix}
1 &amp; -y &amp; p\\
y &amp; 1 &amp; -r\\
-p &amp; r &amp; 1\\
\end{bmatrix} \\
=&amp; \boldsymbol I +
\begin{bmatrix}
r\\
p\\
y
\end{bmatrix}^\land
\end{aligned}
\]</span></p>
<p>带入前式可以得到 <span class="math display">\[
\boldsymbol \omega_{A_i}
= \begin{bmatrix}
r\\
p\\
y
\end{bmatrix}^\land \boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i}
+ \boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i}
= -(\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i})^\land
\begin{bmatrix}
r\\
p\\
y
\end{bmatrix} + \boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i}
\]</span></p>
<p>因此原问题变成 <span class="math display">\[
(\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i})^\land
\begin{bmatrix}
r\\
p\\
y
\end{bmatrix}
= \boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_i} - \boldsymbol
\omega_{A_i}, \quad i = 1,\cdots,n
\]</span></p>
<p>将 <span class="math inline">\(n\)</span> 个方程可以写成矩阵形式
<span class="math display">\[
\begin{bmatrix}
(\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_1})^\land \\
\vdots \\
(\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_n})^\land
\end{bmatrix}
\begin{bmatrix}
r\\
p\\
y
\end{bmatrix}
=
\begin{bmatrix}
\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_1} - \boldsymbol
\omega_{A_1} \\
\vdots \\
\boldsymbol X_0 \boldsymbol \omega_{\boldsymbol B_n} - \boldsymbol
\omega_{A_n}
\end{bmatrix}
\]</span></p>
<p>此问题为经典 <span class="math inline">\(\boldsymbol A \boldsymbol x
= \boldsymbol b\)</span> 问题，其解为 <span class="math display">\[
\boldsymbol x = (\boldsymbol A^T \boldsymbol A)^{-1} \boldsymbol A^T
\boldsymbol b = \boldsymbol V \Lambda^+ \boldsymbol U^T \boldsymbol b
\]</span></p>
<p>其中 <span class="math inline">\(\boldsymbol A = \boldsymbol U
\Lambda \boldsymbol V^T\)</span>，<span
class="math inline">\(\Lambda^+\)</span> 为伪逆 <span
class="math display">\[
\Lambda^+ =
\begin{bmatrix}
\frac{1}{\lambda_1}\\
&amp; \ddots\\
&amp;&amp; \frac{1}{\lambda_m}\\
&amp;&amp;&amp; 0\\
&amp;&amp;&amp;&amp; \ddots\\
&amp;&amp;&amp;&amp;&amp; 0
\end{bmatrix}
\]</span></p>
<h3 id="误差分析">误差分析</h3>
<p>对于优化方程 <span class="math inline">\(f(x,
z_1,\cdots,z_n)\)</span>，其中 <span class="math inline">\(x\)</span>
为需要求解的变量，<span class="math inline">\(z_i\)</span>
为观测得到的变量，如果通过求导来求得最优解 <span
class="math inline">\(x^*\)</span>，那么有 <span
class="math inline">\(\frac{\partial f(x^*, z_1,\cdots,z_n)}{\partial x}
= F(x^*, z_1,\cdots,z_n) = 0\)</span>，该方程通过计算可以得到 <span
class="math inline">\(x^* = g(z_1,\cdots,z_n)\)</span>，假设 <span
class="math inline">\(z_i\)</span> 均在真值 <span
class="math inline">\(z_i^0\)</span> 附近，将函数 <span
class="math inline">\(g\)</span> 在真值处进行泰勒展开可以得到 <span
class="math display">\[
x^*=g(z_1,\cdots,z_n) \approx
g(z_1^0,\cdots,z_n^0)+\sum_{i=1}^n\frac{\partial g}{\partial z_i}(z_i -
z_i^0)
\]</span></p>
<p>如果观测量 <span class="math inline">\(z_i\)</span>
相互之间独立，则有 <span class="math display">\[
cov(x) \approx \sum_{i = 1}^n \frac{\partial g}{\partial z_i} cov(z_i)
\frac{\partial g}{\partial z_i}^T
\]</span></p>
<p>根据隐函数定理 <span class="math display">\[
\begin{aligned}
\frac{\partial g}{\partial z_i}
=&amp; -\bigg( \frac{\partial F}{\partial x} \bigg)^{-1}\frac{\partial
F}{\partial z_i} \\
=&amp; -\bigg( \frac{\partial^2 f}{\partial x^2} \bigg)^{-1}
\frac{\partial^2 f}{\partial z_i \partial x}
\end{aligned}
\]</span></p>
<p>由此可以得到最优解 <span class="math inline">\(x^*\)</span>
的协方差矩阵为 <span class="math display">\[
cov(x) \approx \sum_{i = 1}^n \bigg( \frac{\partial^2 f}{\partial x^2}
\bigg)^{-1} \frac{\partial^2 f}{\partial z_i \partial x} cov(z_i)
\frac{\partial^2 f}{\partial z_i \partial x}^T \bigg( \frac{\partial^2
f}{\partial x^2} \bigg)^{-1}
\]</span></p>
<p>当前 <span class="math display">\[
\begin{aligned}
f(\boldsymbol{\omega}_{\boldsymbol{X}},
\boldsymbol{\omega}_{\boldsymbol{B}_i},
\boldsymbol{\omega}_{\boldsymbol{A}_i})
=&amp; \sum_{i = 1}^n w_i \|
e^{\boldsymbol{\omega}_{\boldsymbol{X}}^\land}
\boldsymbol{\omega}_{\boldsymbol{B}_i}-
\boldsymbol{\omega}_{\boldsymbol{A}_i} \|^2\\
=&amp; \sum_{i = 1}^n w_i (\boldsymbol{\omega}_{\boldsymbol{B}_i}^T
{e^{\boldsymbol{\omega}_{\boldsymbol{X}}^\land}}^T
e^{\boldsymbol{\omega}_{\boldsymbol{X}}^\land}
\boldsymbol{\omega}_{\boldsymbol{B}_i} -
2\boldsymbol{\omega}_{\boldsymbol{A}_i}^T
e^{\boldsymbol{\omega}_{\boldsymbol{X}}^\land}
\boldsymbol{\omega}_{\boldsymbol{B}_i} +
\boldsymbol{\omega}_{\boldsymbol{A}_i}^T
\boldsymbol{\omega}_{\boldsymbol{A}_i} )\\
=&amp; \sum_{i = 1}^n w_i
(\boldsymbol{\omega}_{\boldsymbol{B}_i}^T\boldsymbol{\omega}_{\boldsymbol{B}_i}
- 2\boldsymbol{\omega}_{\boldsymbol{A}_i}^T
e^{\boldsymbol{\omega}_{\boldsymbol{X}}^\land}
\boldsymbol{\omega}_{\boldsymbol{B}_i} +
\boldsymbol{\omega}_{\boldsymbol{A}_i}^T
\boldsymbol{\omega}_{\boldsymbol{A}_i} )
\end{aligned}
\]</span></p>
<p>采用右扰动，推导得到一阶导 <span class="math display">\[
\frac{\partial f}{\partial \boldsymbol{\omega_X}}
= 2\sum_{i=1}^n w_i (\boldsymbol{X}^T \boldsymbol{\omega_{A_i}})^\land
\boldsymbol{\omega_{B_i}}
= -2\sum_{i=1}^n w_i \boldsymbol{\omega_{B_i}}^\land \boldsymbol{X}^T
\boldsymbol{\omega_{A_i}}
\]</span></p>
<p>继续推导得到二阶导 <span class="math display">\[
\begin{aligned}
\frac{\partial^2 f}{\partial \boldsymbol{\omega_X}^2}
=&amp; -2\sum_{i=1}^n w_i (\boldsymbol{X}^T
\boldsymbol{\omega_{A_i}})^\land \boldsymbol{\omega_{B_i}}^\land
= -2\sum_{i=1}^n w_i (\boldsymbol{\omega_{B_i}}^\land)^2 \\
\frac{\partial^2 f}{\partial \boldsymbol{\omega_{B_i}}\partial
\boldsymbol{\omega_X}}
=&amp; -2w_i (\boldsymbol{X}^T \boldsymbol{\omega_{A_i}})^\land
= -2w_i \boldsymbol{\omega_{B_i}}^\land \\
\frac{\partial^2 f}{\partial \boldsymbol{\omega_{A_i}}\partial
\boldsymbol{\omega_X}}
=&amp; 2w_i \boldsymbol{X} \boldsymbol{\omega_{B_i}}^\land
\end{aligned}
\]</span></p>
<p>采用左扰动，推导得到一阶导 <span class="math display">\[
\frac{\partial f}{\partial \boldsymbol{\omega_X}}
= 2\sum_{i=1}^n w_i \boldsymbol\omega_{A_i}^\land \boldsymbol{X}
\boldsymbol{\omega_{B_i}}
= -2\sum_{i=1}^n w_i (\boldsymbol{X} \boldsymbol{\omega_{B_i}})^\land
\boldsymbol{\omega_{A_i}}
\]</span></p>
<p>继续推导得到二阶导 <span class="math display">\[
\begin{aligned}
\frac{\partial^2 f}{\partial \boldsymbol{\omega_X}^2}
=&amp; -2\sum_{i=1}^n w_i
(\boldsymbol{X}\boldsymbol{\omega_{B_i}})^\land
\boldsymbol{\omega_{A_i}}^\land
= -2\sum_{i=1}^n w_i (\boldsymbol{\omega_{A_i}}^\land)^2 \\
\frac{\partial^2 f}{\partial \boldsymbol{\omega_{B_i}}\partial
\boldsymbol{\omega_X}}
=&amp; -2w_i \boldsymbol{X}^T \boldsymbol{\omega_{A_i}}^\land\\
\frac{\partial^2 f}{\partial \boldsymbol{\omega_{A_i}}\partial
\boldsymbol{\omega_X}}
=&amp; 2w_i (\boldsymbol{X} \boldsymbol{\omega_{B_i}})^\land
= 2w_i \boldsymbol{\omega_{A_i}}^\land
\end{aligned}
\]</span></p>
<p>因此有 <span class="math display">\[
\begin{aligned}
\Delta\boldsymbol{\omega_X}
=&amp; -\sum_{i=1}^n \bigg( \frac{\partial^2 f}{\partial
\boldsymbol{\omega_X}^2} \bigg)^{-1} \frac{\partial^2 f}{\partial
\boldsymbol{\omega_{B_i}}\partial \boldsymbol{\omega_X}}
\Delta\boldsymbol{\omega_{B_i}} \\
&amp;- \sum_{i=1}^n \bigg( \frac{\partial^2 f}{\partial
\boldsymbol{\omega_X}^2} \bigg)^{-1} \frac{\partial^2 f}{\partial
\boldsymbol{\omega_{A_i}}\partial \boldsymbol{\omega_X}}
\Delta\boldsymbol{\omega_{A_i}} \\
=&amp; -\bigg( \sum_{i=1}^n w_i(\boldsymbol{\omega_{B_i}}^\land)^2
\bigg)^{-1} \sum_{i=1}^n w_i \boldsymbol{\omega_{B_i}}^\land
\Delta\boldsymbol{\omega_{B_i}}\\
&amp;+\bigg( \sum_{i=1}^n w_i(\boldsymbol{\omega_{A_i}}^\land)^2
\bigg)^{-1} \sum_{i=1}^n w_i \boldsymbol{\omega_{A_i}}^\land
\Delta\boldsymbol{\omega_{A_i}}
\end{aligned}
\]</span></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/07/04/%E7%A8%8B%E5%BA%8F%E5%B0%8F%E6%8A%80%E5%B7%A7/" rel="prev" title="程序小技巧">
                  <i class="fa fa-chevron-left"></i> 程序小技巧
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/07/04/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/" rel="next" title="卡尔曼滤波">
                  卡尔曼滤波 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/kevincabbage" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
